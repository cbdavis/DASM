---
title: "Practical 5"
author: "Chris Davis"
date: "October 3, 2016"
output: 
    html_document:
        toc: true
        number_sections: true

---

```{r, eval=FALSE}
install.packages("dplyr")
```

```{r, message=FALSE}
library(ggplot2)
library(dplyr)
```

# Monte Carlo simulation 

## Short reminder of the lecture

x = f(u,v)

u has uncertainty su 
v has uncertainty sv

Construct normal distribution fn,u around u with standard deviation su 
Construct normal distribution fn,v around v with standard deviation sv

Take a random value u1 from  fn,u and v1 from fn,v  and calculate x1 = f(u1, v1)

Repeat n times

Take average (or median) of all xi (i = 1, …n) 

## Example from the lecture (page 25, for now; might be slightly different)
(Chris, maybe add some explanation)

```{r}
n <- 1000
p <- rnorm(n, mean = 2, sd = 0.5)
q <- rnorm(n, mean = 5, sd = 1)
f <- p*q/(p+q)
f_bar <- mean(f)
sig <- sd(f)
```

## Try on your own:

Give them a different formula  x = f(u,v)

Let them try a monte carlo simulation with different n 

Tasks:
 
* plot the histogram of x
* calculate mean(x) and std(x)

If there is enough time you could explain, how to do it with a loop for different n and re-create a plot like in lecture pgs 27, 28

# Working with real data sets

This is not related to the lecture, so I think I leave this to you. 

I attach two practicals that they had last year, where I taught them the basic of working with data frames, subsets, dates and times etc … 

I think it would be good to keep the structure that we had so far:

* Introduce a concept
* walk them through an example 
* let them try an exercise by themselves

The Guerry data file:

**TODO** have the students download this to their own computer, explain right click, etc (copy from Practical 1).  Add link (where don't show url directly)

Read it in: 
```{r}
data1 <- read.csv(file ="https://raw.githubusercontent.com/cbdavis/DASM/master/data/Guerry.csv")
```

**TODO** explain the different columns - 17 observations per region, 1 NA, etc - how factors and numbers are shown differently.  If you don't see quantiles, it's counting factors

Get an idea what is in it:
```{r}
summary(data1)
```

This is a data set from the Guerry R package, so to get an idea about the variables we need to install the package:
```{r, eval=FALSE}
install.packages("Guerry")
```

Load the library:
```{r}
library(Guerry)
```

and then bring up the help information that relates to this specific data frame which is included in the package:
```{r}
help(Guerry)
```

French cities and statistics about them

* A few categories: Region, Main_city
* A few numerical variables: e.g., Crime pers … Suicides
* A few rank variables: Donations, 

1) Select any numerical variable and plot a histogram

2) Choose variable "Literacy" and make a box plot per region and city size (MainCity)  

**TODO** what is meant here?  This seems to be done in two commands further below

hint: data1~xxx, groups data by the categories contained in the variable xxx

**TODO** split this into two boxplots as shown below

```{r}
ggplot(data1, aes(x=Region, y=Literacy)) + geom_boxplot() + facet_wrap(~MainCity)
```

1) Select any numerical variable and plot a histogram

```{r}	
hist(data1$Infants)
```

2) Choose numerical variable and make a box plot per region and city size (MainCity)  

**TODO** this seems to be what is mentioned above

```{r}
boxplot(data1$Literacy~data1$Region)
boxplot(data1$Literacy~data1$MainCity)
```

3) we see that the box in the small cities looks weird, we want to take a closer look 

3a) First we want to know how many variables are in the small, medium and large cities

```{r}
a <- table(data1$MainCity)
a
```

3b) Now we want to see the actual data points in the small cities only:
Subset command!

**TODO** which dataset is this?  Only focus on using with data1?

The subset( ) function is the easiest way to select variables and observations. In the following example, we select all rows that have a value of age greater than or equal to 20 or age less then 10. We keep the ID and Weight columns.

 using subset function 
```{r, eval=FALSE}
newdata <- subset(mydata, age >= 20 | age < 10, select=c(ID, Weight))
```

In the next example, we select all men over the age of 25 and we keep variables weight through income (weight, income and all columns between them).

using subset function (part 2)

```{r, eval=FALSE}
newdata <- subset(mydata, sex=="m" & age > 25, select=weight:income)
```

3b) Now: apply to data1

Note that the `==` is a check to see if two values are equal to each other

```{r}
small_data <- subset(data1, MainCity ==  "1:Sm", select = Literacy)
plot(small_data)

small_data <- data1 %>% filter(MainCity ==  "1:Sm") %>% select(Literacy)
plot(small_data)

```

4) Make a boxplot of crime vs city size

You see a large outlier in the small cities. This would disturb a test like ANOVA. remove the outlier

**TODO** the part with `!(MainCity == "1:Sm" & Crime_prop > 15000)` really needs to be explained

* `!` means
* `==` means
* `&` means
* then `(`...`)` means

```{r}
data2 <- subset(data1, !(MainCity == "1:Sm" & Crime_prop > 15000))
boxplot(data2$Crime_prop~data2$MainCity)

# dplyr method
data2 = data1 %>% filter(!(MainCity == "1:Sm" & Crime_prop > 15000))
boxplot(data2$Crime_prop~data2$MainCity)
```

5) select any row and column you want 

```{r}
b <- data1[1:3, 5:9]
c <- data1[c(1,5,9), 7]
```

6) Make a table of city size vs region

```{r}
tab = table(data1$MainCity, data1$Region)
tab
```

See /home/cbdavis/Desktop/svn/ChrisDavis/Education/DASM/ComputerPracticals/Practical_2015_example_chris.pptx
```{r}
stuff = read.csv("/home/cbdavis/Desktop/svn/ChrisDavis/Education/DASM/ComputerPracticals/Practical4.csv")
```

**TODO** if too much material, leave out the boxplots
